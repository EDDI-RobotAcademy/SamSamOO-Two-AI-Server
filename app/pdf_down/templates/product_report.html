<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>{{ product.title or 'ìƒí’ˆ' }} ë¶„ì„ ë³´ê³ ì„œ</title>
  <style>
    /* ---- ì¸ì‡„ ë ˆì´ì•„ì›ƒ ---- */
    @page { size: A4; margin: 16mm; }
    * { box-sizing: border-box; }
    html, body { padding:0; margin:0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      color:#1f2937;  /* gray-800 */
      font-size: 12.5px; line-height:1.65;
      background:#fff;
    }

    /* ---- ìœ í‹¸ ---- */
    .wrap { max-width: 800px; margin: 0 auto; }
    .muted { color:#6b7280; }     /* gray-500 */
    .small { font-size: 11px; }
    .mt-6 { margin-top: 24px; }
    .mt-3 { margin-top: 12px; }
    .mb-0 { margin-bottom: 0; }
    .row { display:flex; gap:12px; }
    .grid-3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px; }
    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .section {
      border:1px solid #e5e7eb;   /* gray-200 */
      border-radius: 12px;
      padding: 16px 18px;
      background:#fff;
    }
    .section h2 {
      display:flex; align-items:center; gap:8px;
      font-size: 18px; margin: 0 0 10px 0; color:#111827; /* gray-900 */
    }
    .pill {
      display:inline-block;
      padding: 6px 10px; border-radius: 999px;
      background:#eef2ff;      /* indigo-50 */
      color:#4338ca;           /* indigo-700 */
      border:1px solid #e0e7ff;/* indigo-100 */
      font-weight: 600; font-size: 12px;
      margin: 4px 6px 0 0;
    }
    .header {
      display:flex; justify-content:space-between; align-items:flex-start;
      padding: 18px 20px; border-radius:14px;
      border:1px solid #e5e7eb; background:#fafafa;
    }
    .title { font-size: 20px; font-weight: 800; margin:0 0 6px 0; }
    .kv { display:grid; grid-template-columns: 90px 1fr; row-gap:6px; column-gap:8px; }
    .kv b { color:#374151; } /* gray-700 */

    /* ---- ì¹´ë“œ(ë¶„ì„ ìˆ˜ì¹˜) ---- */
    .stat {
      border:1px solid #e5e7eb; border-radius:12px; padding:14px;
      text-align:center; background:#fcfcff;
    }
    .stat .label { font-size:13px; color:#6b7280; margin-bottom:6px; }
    .stat .value { font-size:24px; font-weight:800; margin:2px 0 0 0; }
    .pos   { background:#ecfdf5; border-color:#a7f3d0; } /* green */
    .pos .value { color:#059669; }
    .neu   { background:#f3f4f6; border-color:#e5e7eb; } /* gray */
    .neu .value { color:#4b5563; }
    .neg   { background:#fef2f2; border-color:#fecaca; } /* red */
    .neg .value { color:#dc2626; }

    /* ---- ì´ìŠˆ ë¦¬ìŠ¤íŠ¸ ---- */
    .issues { margin:6px 0 0 0; padding-left:0; list-style:none; }
    .issues li { display:flex; gap:8px; align-items:flex-start; margin:6px 0; }
    .issues .icon { font-size: 14px; line-height: 1.2; color:#b45309; } /* amber-700 */
    .issues .text { flex:1; }

    /* ---- ë¦¬ë·° ë°•ìŠ¤(ì˜µì…˜) ---- */
    .review-item { border:1px solid #e5e7eb; border-radius:10px; padding:10px 12px; margin-top:8px; }
    .review-meta { color:#6b7280; font-size:11.5px; }

    /* ---- í‘¸í„° ---- */
    .footer { margin-top:22px; color:#6b7280; font-size:11px; }

    /* í˜ì´ì§€ ë²ˆí˜¸ (WeasyPrint ê¸°ì¤€) */
    @page {
      @bottom-right { content: "Page " counter(page) " / " counter(pages); font-size:10px; color:#9ca3af; }
    }

    /* ê¸´ URLë„ ì „ì²´ê°€ í´ë¦­ë˜ê²Œ ì¤„ë°”ê¿ˆ í—ˆìš© */
    .breakable-link {
      word-break: break-all;
      white-space: normal;
      color: #0066cc;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- í—¤ë” -->
    <div class="header">
      <div>
        <div class="title">ìƒí’ˆ ë¶„ì„ ë³´ê³ ì„œ</div>
        <div class="muted small">ìƒì„±ì¼: {{ generated_at }}</div>
      </div>
      <div class="muted small">í”Œë«í¼: <b>{{ product.source }}</b></div>
    </div>

    <!-- ìƒí’ˆ ì •ë³´ -->
    <div class="section mt-6">
      <h2>ğŸ“¦ ìƒí’ˆ ì •ë³´</h2>
      <div class="kv">
        <div class="muted">ìƒí’ˆëª…</div>
        <div><b>{{ product.title or '-' }}</b></div>

        <div class="muted">ê°€ê²©</div>
        <div><b>{{ "{:,}".format(product.price or 0) }}ì›</b></div>

        <div class="muted">ìƒí’ˆ ID</div>
        <div>{{ product.source_product_id }}</div>

        <div class="muted">ë“±ë¡ì¼</div>
        <div>{{ product.collected_at or '-' }}</div>

        <div class="muted">URL</div>
        <div class="small">
          {% if product.source_url %}
            <a href="{{ product.source_url }}" target="_blank" rel="noopener" class="breakable-link">
              {{ product.source_url }}
            </a>
          {% else %}
            -
          {% endif %}
        </div>

        {% if product.seller %}
        <div class="muted">íŒë§¤ì</div>
        <div>{{ product.seller }}</div>
        {% endif %}

        {% if product.category %}
        <div class="muted">ì¹´í…Œê³ ë¦¬</div>
        <div>{{ product.category }}</div>
        {% endif %}

        {% if product.review_count or product.rating %}
        <div class="muted">ë¦¬ë·°/í‰ì </div>
        <div>{{ product.review_count or 0 }}ê±´ Â· â˜… {{ product.rating or '-' }}</div>
        {% endif %}
      </div>
    </div>

    <!-- ë¶„ì„ ê²°ê³¼ -->
    <div class="section mt-6">
      <h2>ğŸ“Š ë¶„ì„ ê²°ê³¼</h2>

      <div class="grid-3">
        <div class="stat pos">
          <div class="label">ê¸ì •</div>
          <div class="value">{{ analysis.sentiment_json.positive or 0 }}%</div>
        </div>
        <div class="stat neu">
          <div class="label">ì¤‘ë¦½</div>
          <div class="value">{{ analysis.sentiment_json.neutral or 0 }}%</div>
        </div>
        <div class="stat neg">
          <div class="label">ë¶€ì •</div>
          <div class="value">{{ analysis.sentiment_json.negative or 0 }}%</div>
        </div>
      </div>

      {# keywords / issues: keywords_json, issues_json ìš°ì„  + top_* í´ë°± #}
      {% set _keywords = analysis.keywords_json or analysis.top_keywords or [] %}
      {% set _issues   = analysis.issues_json   or analysis.top_issues   or [] %}

      <div class="mt-6">
        <div class="muted" style="font-weight:700; margin-bottom:6px;">ì£¼ìš” í‚¤ì›Œë“œ</div>
        {% if _keywords and _keywords|length > 0 %}
          {% for k in _keywords %}
            <span class="pill">{{ k }}</span>
          {% endfor %}
        {% else %}
          <div class="muted">í‘œì‹œí•  í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        {% endif %}
      </div>

      <div class="mt-6">
        <div class="muted" style="font-weight:700; margin-bottom:6px;">ì£¼ìš” ì´ìŠˆ</div>
        {% if _issues and _issues|length > 0 %}
          <ul class="issues">
            {% for i in _issues %}
              <li>
                <span class="icon">âš ï¸</span>
                <div class="text">{{ i }}</div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="muted">ë³´ê³ ëœ ì´ìŠˆê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        {% endif %}
      </div>
    </div>

    <!-- ì¸ì‚¬ì´íŠ¸ -->
    <div class="section mt-6">
      <h2>ğŸ¤– AI ì¸ì‚¬ì´íŠ¸</h2>
      <p class="mb-0">{{ insight.summary or 'ë¶„ì„ ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤.' }}</p>
    </div>

    {% if reviews and reviews|length %}
    <!-- (ì˜µì…˜) ë¦¬ë·° ì¼ë¶€ ë°œì·Œ -->
    <div class="section mt-6">
      <h2>ğŸ“ ë¦¬ë·° í•˜ì´ë¼ì´íŠ¸</h2>
      {% for r in reviews[:12] %}
        <div class="review-item">
          <div class="review-meta">
            {{ r.reviewer or '-' }} Â· â˜… {{ r.rating or '-' }} Â· {{ r.review_at or '' }}
          </div>
          <div>{{ r.content or '' }}</div>
        </div>
      {% endfor %}
      {% if reviews|length > 12 %}
        <div class="muted small mt-3">â€¦ ê·¸ ì™¸ {{ reviews|length - 12 }}ê±´</div>
      {% endif %}
    </div>
    {% endif %}

    <div class="footer">â€» ë³¸ ë¬¸ì„œëŠ” ë‚´ë¶€ ë³´ê³ ìš©ìœ¼ë¡œ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
  </div>
</body>
</html>
